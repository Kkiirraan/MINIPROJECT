<!DOCTYPE html>
<html>
<head>
    <title>Room Details</title>
    <style>
        h2 {
            text-align: center;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .room-details {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #000;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        tbody td div {
            margin-bottom: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        select, input[type="text"] {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            width: 100%;
        }

        .add-button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
        }

        .add-button:hover {
            background-color: #0056b3;
        }

        .message {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            color: #007bff;
        }
        #add-button {
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        #add-button:hover {
            background-color: #0069d9;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    {% include 'nav2.html' %}
    <h2>Allot Students</h2>
    <p>Dept : {{room[0][3]}}</p>
    <p>Room Number: {{ room[0][4] }}</p>
    <p>Number of Benches: {{ room[0][6] }}</p>
    <p>Number of Students per Bench: {{ room[0][5] }}</p>
    <p>Capacity of the room: {{ room[0][7]}}</p>
    <p>Date of exam: {{ room[0][0]}}</p>
    <p>Time:{{room[0][1]}} {{room[0][2]}}</p>
    <table>

        <thead>
            <tr>
                {% for i in range(room[0][5]) %}
                    <th>COLUMN {{ i+1 }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody id="table-body">
            <tr>
                {% for i in range(room[0][5]) %}
                    <td>
                        <div>
                            <label>Class:</label>
                            <select id="class-dropdown-{{ i+1 }}" class="class-dropdown">
                                <option value="">Select a class</option>
                                <option value="7">s1</option>
                                <option value="7">s2</option>
                                <option value="7">s4</option>
                            </select>
                        </div>
                        <div>
                            <label>From:</label>
                            <input type="text" id="from-{{ i+1 }}" class="from-input" oninput="getdetails('from-{{ i+1 }}')">

                        </div>
                        <div>
                            <label>To:</label>
                            <input type="text" id="to-{{ i+1 }}" class="to-input" >
                        </div>
                    </td>
                {% endfor %}
            </tr>
        </tbody>
    </table>
    
    <br><br>
       <center> <button type="submit" id="add-button">add</button></center>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#options').change(function() {
                var selectedOption = $(this).val();
                $.ajax({
                    type: 'POST',
                    url: '/get_details',
                    data: {option: selectedOption},
                    success: function(data) {
                        $('#details').html(data);
                    }
                });
            });
        });
    
        function getdetails(i) {
            var a = Number(document.getElementById(i).value);
            var b = Number("{{ room[0][6] }}"); 
            b = b - 1 ;
            var c = a + b; 
            document.getElementById("to-"+i.slice(5)).value = String(c); 
        }
        $(document).ready(function() {
        
            $('body').on('click', '#add-button', function() {
                var data = {
                    'dept':"{{ room[0][3] }}",
                    'date':"{{ room[0][0] }}",
                    'time':"{{ room[0][1] }}",
                    'mer' : "{{ room[0][2] }}",
                    'room_number': "{{ room[0][4] }}",
                    'students': []
                };
                {% for i in range(room[0][5]) %}
                    var row = {
                        'class': $('#class-dropdown-{{ i+1 }}').val(),
                        'from': $('#from-{{ i+1 }}').val(),
                        'to': $('#to-{{ i+1 }}').val(),
                    };
                    data.students.push(row);
                {% endfor %}
                var jsonData = JSON.stringify(data);
                
                $.ajax({
                    url: '/add_data',
                    type: 'POST',
                    data: jsonData,
                    contentType: 'application/json',
                    beforeSend: function(xhr) {
                        if (data.length === 0) {
                            alert('Data is empty');
                            xhr.abort();
                        }
                    },
                    success: function(response) {
                        console.log(response);
                        $('#add-button').text('Alloted');
                        $('#add-button').prop('disabled', true);
                       
                      },
                      error: function(xhr, status, error) {
                        console.log(error);
                      }
                });
            });
        });
        
        
    </script>
    {{message}}
    {{ details}}
</body>
</html>
